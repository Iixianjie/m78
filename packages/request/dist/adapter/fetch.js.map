{"version":3,"sources":["/Users/lixianjie/project/openSource/m78/packages/request/src/adapter/fetch.ts"],"sourcesContent":["import { BaseRequestOptions } from \"../interfaces\";\nimport { Response } from \"../response\";\nimport { ResponseError } from \"../response-error\";\nimport qs from \"query-string\";\n\nexport interface FetchOptions<Ext = {}>\n  extends Omit<RequestInit, \"body\" | \"headers\">,\n    BaseRequestOptions<Ext> {}\n\n/** fetch适配 */\nexport function fetchAdapter(opt: FetchOptions) {\n  return fetch(`${opt.url}${qs.stringify(opt.query)}`, opt)\n    .then(async (res) => {\n      const response = new Response();\n\n      response.message = res.statusText;\n      response.code = res.status;\n\n      const h: any = {};\n\n      for (const [k, v] of res.headers.entries()) {\n        h[k] = v;\n      }\n\n      response.headers = h;\n\n      const type = h[\"content-type\"] || h[\"Content-Type\"];\n\n      if (type.includes(\"application/json\")) {\n        response.data = await res.json();\n      }\n\n      if (type.includes(\"text/\")) {\n        response.data = await res.text();\n      }\n\n      response.original = res;\n      return response;\n    })\n    .catch((err) => {\n      return Promise.reject(\n        new ResponseError(`${err.name}: ${err.message}` || \"\")\n      );\n    });\n}\n"],"names":["Response","ResponseError","qs","fetchAdapter","opt","fetch","url","stringify","query","then","res","response","h","k","v","type","message","statusText","code","status","headers","entries","includes","json","data","text","original","catch","err","Promise","reject","name"],"mappings":"AAAA;;;AACA,SAASA,QAAQ,QAAQ,aAAa,CAAC;AACvC,SAASC,aAAa,QAAQ,mBAAmB,CAAC;AAClD,OAAOC,EAAE,MAAM,cAAc,CAAC;AAM9B,YAAY,GACZ,OAAO,SAASC,YAAY,CAACC,GAAiB,EAAE;IAC9C,OAAOC,KAAK,CAAC,AAAC,EAAA,CAAYH,MAAuB,CAAjCE,GAAG,CAACE,GAAG,CAA2B,CAAA,MAAA,CAAxBJ,EAAE,CAACK,SAAS,CAACH,GAAG,CAACI,KAAK,CAAC,CAAE,EAAEJ,GAAG,CAAC,CACtDK,IAAI;mBAAC,oBAAA,SAAOC,GAAG,EAAK;gBACbC,QAAQ,EAKRC,CAAC,QAEF,yBAAY,EAAZ,iBAAY,EAAZ,cAAY,EAAZ,SAAY,EAAZ,KAAY,UAALC,CAAC,EAAEC,CAAC,EAMVC,IAAI;;;;wBAbJJ,QAAQ,GAAG,IAAIX,QAAQ,EAAE,CAAC;wBAEhCW,QAAQ,CAACK,OAAO,GAAGN,GAAG,CAACO,UAAU,CAAC;wBAClCN,QAAQ,CAACO,IAAI,GAAGR,GAAG,CAACS,MAAM,CAAC;;wBAErBP,CAAC,OAAU,CAAC;wBAEb,yBAAY,SAAZ,iBAAY,UAAZ,cAAY;;4BAAjB,IAAK,SAAY,GAAIF,GAAG,CAACU,OAAO,CAACC,OAAO,EAAE,uBAArC,yBAAY,IAAZ,KAAY,GAAZ,SAAY,gBAAZ,yBAAY,QAA2B;0DAAvC,KAAY,YAALR,CAAC,YAAA,EAAEC,CAAC,YAAA,CAAC;gCACfF,CAAC,CAACC,CAAC,CAAC,GAAGC,CAAC,CAAC;4BACX,CAAC;;4BAFI,iBAAY;4BAAZ,cAAY;;;qCAAZ,yBAAY,IAAZ,SAAY;oCAAZ,SAAY;;;oCAAZ,iBAAY;0CAAZ,cAAY;;;;wBAIjBH,QAAQ,CAACS,OAAO,GAAGR,CAAC,CAAC;wBAEfG,IAAI,GAAGH,CAAC,CAAC,cAAc,CAAC,IAAIA,CAAC,CAAC,cAAc,CAAC,CAAC;6BAEhDG,IAAI,CAACO,QAAQ,CAAC,kBAAkB,CAAC,EAAjCP;;;0BAAiC;wBACnB;;4BAAML,GAAG,CAACa,IAAI,EAAE;0BAAA;;wBAAhCZ,QAAQ,CAACa,IAAI,GAAG,aAAgB,CAAC;;;6BAG/BT,IAAI,CAACO,QAAQ,CAAC,OAAO,CAAC,EAAtBP;;;0BAAsB;wBACR;;4BAAML,GAAG,CAACe,IAAI,EAAE;0BAAA;;wBAAhCd,QAAQ,CAACa,IAAI,GAAG,aAAgB,CAAC;;;wBAGnCb,QAAQ,CAACe,QAAQ,GAAGhB,GAAG,CAAC;wBACxB;;4BAAOC,QAAQ;0BAAC;;;QAClB,CAAC,CAAA;wBA1BYD,GAAG;;;QA0Bd,CACDiB,KAAK,CAAC,SAACC,GAAG,EAAK;QACd,OAAOC,OAAO,CAACC,MAAM,CACnB,IAAI7B,aAAa,CAAC,AAAC,EAAA,CAAe2B,MAAW,CAAxBA,GAAG,CAACG,IAAI,EAAC,IAAE,CAAc,CAAA,MAAA,CAAZH,GAAG,CAACZ,OAAO,CAAE,IAAI,EAAE,CAAC,CACvD,CAAC;IACJ,CAAC,CAAC,CAAC;AACP,CAAC"}