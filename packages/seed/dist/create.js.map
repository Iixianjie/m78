{"version":3,"sources":["/Users/lixianjie/project/openSource/m78/packages/seed/src/create.ts"],"sourcesContent":["import { Seed, SetState, Share, CoverSetState, SeedCreator } from './types';\nimport { middlewareImpl, subscribeImpl } from './common';\n\nconst create: SeedCreator = (conf = {}) => {\n  const [config, patchHandle] = middlewareImpl(conf);\n\n  const { state } = config;\n\n  const share: Share = {\n    state: { ...state! },\n    listeners: [],\n  };\n\n  const setState: SetState = patch => {\n    share.state = { ...share.state!, ...patch };\n    /** 触发listener */\n    share.listeners.forEach(listener => listener(patch));\n  };\n\n  const coverSetState: CoverSetState = patch => {\n    share.state = { ...patch };\n    /** 触发listener */\n    share.listeners.forEach(listener => listener(patch));\n  };\n\n  const subscribe = subscribeImpl(share);\n\n  const apis = {\n    subscribe,\n    set: setState,\n    coverSet: coverSetState,\n    get: () => share.state!,\n  } as Seed;\n\n  patchHandle && patchHandle(apis);\n\n  return apis;\n};\n\nexport default create;\n"],"names":["middlewareImpl","subscribeImpl","create","conf","config","patchHandle","state","share","listeners","setState","patch","forEach","listener","coverSetState","subscribe","apis","set","coverSet","get"],"mappings":"AAAA;;AACA,SAASA,cAAc,EAAEC,aAAa,QAAQ,UAAU,CAAC;AAEzD,IAAMC,MAAM,GAAgB,WAAe;QAAdC,IAAI,oEAAG,EAAE;IACpC,IAA8BH,GAAoB,oBAApBA,cAAc,CAACG,IAAI,CAAC,IAAA,EAA3CC,MAAM,GAAiBJ,GAAoB,GAArC,EAAEK,WAAW,GAAIL,GAAoB,GAAxB,AAAyB;IAEnD,IAAM,AAAEM,KAAK,GAAKF,MAAM,CAAhBE,KAAK,AAAW,AAAC;IAEzB,IAAMC,KAAK,GAAU;QACnBD,KAAK,EAAE,mBAAKA,KAAK,CAAG;QACpBE,SAAS,EAAE,EAAE;KACd,AAAC;IAEF,IAAMC,QAAQ,GAAaC,SAAAA,KAAK,EAAI;QAClCH,KAAK,CAACD,KAAK,GAAG,mBAAKC,KAAK,CAACD,KAAK,EAAMI,KAAK,CAAE,CAAC;QAC5C,eAAe,GACfH,KAAK,CAACC,SAAS,CAACG,OAAO,CAACC,SAAAA,QAAQ;mBAAIA,QAAQ,CAACF,KAAK,CAAC;SAAA,CAAC,CAAC;IACvD,CAAC,AAAC;IAEF,IAAMG,aAAa,GAAkBH,SAAAA,KAAK,EAAI;QAC5CH,KAAK,CAACD,KAAK,GAAG,mBAAKI,KAAK,CAAE,CAAC;QAC3B,eAAe,GACfH,KAAK,CAACC,SAAS,CAACG,OAAO,CAACC,SAAAA,QAAQ;mBAAIA,QAAQ,CAACF,KAAK,CAAC;SAAA,CAAC,CAAC;IACvD,CAAC,AAAC;IAEF,IAAMI,SAAS,GAAGb,aAAa,CAACM,KAAK,CAAC,AAAC;IAEvC,IAAMQ,IAAI,GAAG;QACXD,SAAS,EAATA,SAAS;QACTE,GAAG,EAAEP,QAAQ;QACbQ,QAAQ,EAAEJ,aAAa;QACvBK,GAAG,EAAE;mBAAMX,KAAK,CAACD,KAAK;SAAC;KACxB,AAAQ,AAAC;IAEVD,WAAW,IAAIA,WAAW,CAACU,IAAI,CAAC,CAAC;IAEjC,OAAOA,IAAI,CAAC;AACd,CAAC,AAAC;AAEF,eAAeb,MAAM,CAAC"}