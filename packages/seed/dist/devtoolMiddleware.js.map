{"version":3,"sources":["/Users/lixianjie/project/openSource/m78/packages/seed/src/devtoolMiddleware.ts"],"sourcesContent":["import { Middleware } from './types';\n\nlet count = 1;\n\nconst devtool: Middleware = bonus => {\n  if (typeof window === 'undefined' || !(window as any).__REDUX_DEVTOOLS_EXTENSION__) {\n    return bonus.init ? bonus.config : undefined;\n  }\n\n  if (bonus.init) {\n    const extension = (window as any).__REDUX_DEVTOOLS_EXTENSION__;\n\n    const dt = extension.connect({\n      name: `${document.title || 'seed'}-${count > 1 ? count : ''}`,\n    });\n\n    dt.init(bonus.config.state);\n\n    bonus.ctx.devtool = dt;\n\n    count++;\n\n    return bonus.config;\n  }\n\n  if (bonus.ctx.devtool) {\n    const ls = () => {\n      bonus.ctx.devtool.send('change state', bonus.apis.get());\n    };\n\n    let uls = bonus.apis.subscribe(ls);\n\n    bonus.ctx.devtool.subscribe((message: any) => {\n      if (message.type === 'DISPATCH' && message.state) {\n        uls();\n        bonus.apis.coverSet(JSON.parse(message.state));\n        uls = bonus.apis.subscribe(ls);\n      }\n    });\n  }\n};\n\nexport default devtool;\n"],"names":["count","devtool","bonus","window","__REDUX_DEVTOOLS_EXTENSION__","init","config","undefined","extension","dt","connect","name","document","title","state","ctx","ls","send","apis","get","uls","subscribe","message","type","coverSet","JSON","parse"],"mappings":"AAEA,IAAIA,KAAK,GAAG,CAAC,AAAC;AAEd,IAAMC,OAAO,GAAeC,SAAAA,KAAK,EAAI;IACnC,IAAI,OAAOC,MAAM,KAAK,WAAW,IAAI,CAAC,AAACA,MAAM,CAASC,4BAA4B,EAAE;QAClF,OAAOF,KAAK,CAACG,IAAI,GAAGH,KAAK,CAACI,MAAM,GAAGC,SAAS,CAAC;IAC/C,CAAC;IAED,IAAIL,KAAK,CAACG,IAAI,EAAE;QACd,IAAMG,SAAS,GAAG,AAACL,MAAM,CAASC,4BAA4B,AAAC;QAE/D,IAAMK,EAAE,GAAGD,SAAS,CAACE,OAAO,CAAC;YAC3BC,IAAI,EAAE,AAAC,EAAA,CAA8BX,MAAsB,CAAlDY,QAAQ,CAACC,KAAK,IAAI,MAAM,EAAC,GAAC,CAAyB,CAAA,MAAA,CAAvBb,KAAK,GAAG,CAAC,GAAGA,KAAK,GAAG,EAAE,CAAE;SAC9D,CAAC,AAAC;QAEHS,EAAE,CAACJ,IAAI,CAACH,KAAK,CAACI,MAAM,CAACQ,KAAK,CAAC,CAAC;QAE5BZ,KAAK,CAACa,GAAG,CAACd,OAAO,GAAGQ,EAAE,CAAC;QAEvBT,KAAK,EAAE,CAAC;QAER,OAAOE,KAAK,CAACI,MAAM,CAAC;IACtB,CAAC;IAED,IAAIJ,KAAK,CAACa,GAAG,CAACd,OAAO,EAAE;QACrB,IAAMe,EAAE,GAAG,WAAM;YACfd,KAAK,CAACa,GAAG,CAACd,OAAO,CAACgB,IAAI,CAAC,cAAc,EAAEf,KAAK,CAACgB,IAAI,CAACC,GAAG,EAAE,CAAC,CAAC;QAC3D,CAAC,AAAC;QAEF,IAAIC,GAAG,GAAGlB,KAAK,CAACgB,IAAI,CAACG,SAAS,CAACL,EAAE,CAAC,AAAC;QAEnCd,KAAK,CAACa,GAAG,CAACd,OAAO,CAACoB,SAAS,CAAC,SAACC,OAAY,EAAK;YAC5C,IAAIA,OAAO,CAACC,IAAI,KAAK,UAAU,IAAID,OAAO,CAACR,KAAK,EAAE;gBAChDM,GAAG,EAAE,CAAC;gBACNlB,KAAK,CAACgB,IAAI,CAACM,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACJ,OAAO,CAACR,KAAK,CAAC,CAAC,CAAC;gBAC/CM,GAAG,GAAGlB,KAAK,CAACgB,IAAI,CAACG,SAAS,CAACL,EAAE,CAAC,CAAC;YACjC,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;AACH,CAAC,AAAC;AAEF,eAAef,OAAO,CAAC"}