{"version":3,"sources":["/Users/lixianjie/project/openSource/m78/packages/utils/src/dom/dom-adaption.ts"],"sourcesContent":["import _throttle from \"lodash/throttle\";\n\nexport interface DomAdaptionConfig {\n  /** 需要自适应的dom元素 */\n  el: HTMLElement;\n  /** 1920 | 设计图宽度 */\n  designWidth?: number;\n  /** 1080 | 设计图高度 */\n  designHeight?: number;\n  /** 是否保证宽高比例（为false时在设计图宽高比与屏幕不同的情况下会出现变形） */\n  keepRatio?: boolean;\n}\n\nconst defaultConfig = {\n  designWidth: 1920,\n  designHeight: 1080,\n  keepRatio: true,\n};\n\n/**\n *  缩放指定dom以兼容屏幕尺寸\n *  缩放比换算公式: 页面实际尺寸 / 设计图尺寸\n *  */\nexport function domAdaption(config: DomAdaptionConfig) {\n  const _config = { ...defaultConfig, ...config };\n\n  fixSize(_config);\n\n  const set = _throttle(\n    () => {\n      fixSize(_config);\n    },\n    1000,\n    { leading: false, trailing: true }\n  );\n\n  window.addEventListener(\"resize\", set);\n\n  return () => {\n    window.removeEventListener(\"resize\", set);\n  };\n}\n\nfunction fixSize({\n  designWidth,\n  designHeight,\n  keepRatio,\n  el,\n}: Required<DomAdaptionConfig>) {\n  const sSize = getScreenSize();\n  const xScale = sSize.w / designWidth;\n  const yScale = sSize.h / designHeight;\n\n  const base = Math.min(xScale, yScale); //  永远悲观的选择最小缩放值\n  const xS = keepRatio ? base : xScale;\n  const yS = keepRatio ? base : yScale;\n\n  el.style.position = \"fixed\";\n  el.style.top = \"50%\";\n  el.style.left = \"50%\";\n  el.style.transform = `scale3d(${xS}, ${yS}, 1) translate3d(-50%, -50%, 0)`;\n  el.style.width = `${designWidth}px`;\n  el.style.height = `${designHeight}px`;\n  el.style.transformOrigin = \"left top\";\n}\n\nfunction getScreenSize() {\n  return {\n    w: window.innerWidth,\n    h: window.innerHeight,\n  };\n}\n"],"names":["_throttle","defaultConfig","designWidth","designHeight","keepRatio","domAdaption","config","_config","fixSize","set","leading","trailing","window","addEventListener","removeEventListener","el","sSize","getScreenSize","xScale","w","yScale","h","base","Math","min","xS","yS","style","position","top","left","transform","width","height","transformOrigin","innerWidth","innerHeight"],"mappings":"AAAA;AAAA,OAAOA,SAAS,MAAM,iBAAiB,CAAC;AAaxC,IAAMC,aAAa,GAAG;IACpBC,WAAW,EAAE,IAAI;IACjBC,YAAY,EAAE,IAAI;IAClBC,SAAS,EAAE,IAAI;CAChB,AAAC;AAEF;;;IAGI,GACJ,OAAO,SAASC,WAAW,CAACC,MAAyB,EAAE;IACrD,IAAMC,OAAO,GAAG,mBAAKN,aAAa,EAAKK,MAAM,CAAE,AAAC;IAEhDE,OAAO,CAACD,OAAO,CAAC,CAAC;IAEjB,IAAME,GAAG,GAAGT,SAAS,CACnB,WAAM;QACJQ,OAAO,CAACD,OAAO,CAAC,CAAC;IACnB,CAAC,EACD,IAAI,EACJ;QAAEG,OAAO,EAAE,KAAK;QAAEC,QAAQ,EAAE,IAAI;KAAE,CACnC,AAAC;IAEFC,MAAM,CAACC,gBAAgB,CAAC,QAAQ,EAAEJ,GAAG,CAAC,CAAC;IAEvC,OAAO,WAAM;QACXG,MAAM,CAACE,mBAAmB,CAAC,QAAQ,EAAEL,GAAG,CAAC,CAAC;IAC5C,CAAC,CAAC;AACJ,CAAC;AAED,SAASD,OAAO,CAAC,KAKa,EAAE;QAJ9BN,WAAW,GADI,KAKa,CAJ5BA,WAAW,EACXC,YAAY,GAFG,KAKa,CAH5BA,YAAY,EACZC,SAAS,GAHM,KAKa,CAF5BA,SAAS,EACTW,EAAE,GAJa,KAKa,CAD5BA,EAAE;IAEF,IAAMC,KAAK,GAAGC,aAAa,EAAE,AAAC;IAC9B,IAAMC,MAAM,GAAGF,KAAK,CAACG,CAAC,GAAGjB,WAAW,AAAC;IACrC,IAAMkB,MAAM,GAAGJ,KAAK,CAACK,CAAC,GAAGlB,YAAY,AAAC;IAEtC,IAAMmB,IAAI,GAAGC,IAAI,CAACC,GAAG,CAACN,MAAM,EAAEE,MAAM,CAAC,AAAC,EAAC,gBAAgB;IACvD,IAAMK,EAAE,GAAGrB,SAAS,GAAGkB,IAAI,GAAGJ,MAAM,AAAC;IACrC,IAAMQ,EAAE,GAAGtB,SAAS,GAAGkB,IAAI,GAAGF,MAAM,AAAC;IAErCL,EAAE,CAACY,KAAK,CAACC,QAAQ,GAAG,OAAO,CAAC;IAC5Bb,EAAE,CAACY,KAAK,CAACE,GAAG,GAAG,KAAK,CAAC;IACrBd,EAAE,CAACY,KAAK,CAACG,IAAI,GAAG,KAAK,CAAC;IACtBf,EAAE,CAACY,KAAK,CAACI,SAAS,GAAG,AAAC,UAAQ,CAASL,MAAE,CAATD,EAAE,EAAC,IAAE,CAAK,CAAA,MAA+B,CAAlCC,EAAE,EAAC,iCAA+B,CAAC,CAAC;IAC3EX,EAAE,CAACY,KAAK,CAACK,KAAK,GAAG,AAAC,EAAA,CAAc,MAAE,CAAd9B,WAAW,EAAC,IAAE,CAAC,CAAC;IACpCa,EAAE,CAACY,KAAK,CAACM,MAAM,GAAG,AAAC,EAAA,CAAe,MAAE,CAAf9B,YAAY,EAAC,IAAE,CAAC,CAAC;IACtCY,EAAE,CAACY,KAAK,CAACO,eAAe,GAAG,UAAU,CAAC;AACxC,CAAC;AAED,SAASjB,aAAa,GAAG;IACvB,OAAO;QACLE,CAAC,EAAEP,MAAM,CAACuB,UAAU;QACpBd,CAAC,EAAET,MAAM,CAACwB,WAAW;KACtB,CAAC;AACJ,CAAC"}