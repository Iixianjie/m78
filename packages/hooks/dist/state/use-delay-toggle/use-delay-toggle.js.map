{"version":3,"sources":["/Users/lixianjie/project/openSource/m78/packages/hooks/src/state/use-delay-toggle/use-delay-toggle.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useSelf } from \"../../\";\n\n/** 代理一个toggle状态, 确保其在关闭前至少开启了duration毫秒, 用于解决loading等组件的闪烁问题 */\nexport function useDelayToggle(toggle: boolean, duration = 300): boolean {\n  const isDisabled = !duration;\n\n  const [innerState, setInnerState] = useState(toggle);\n\n  const self = useSelf({\n    timer: null as any,\n    openTime: toggle ? Date.now() : null,\n  });\n\n  useEffect(() => {\n    if (isDisabled) return;\n\n    if (toggle) {\n      change();\n      return;\n    }\n\n    let surplus = self.openTime ? Date.now() - self.openTime : 0;\n    surplus = duration - surplus;\n\n    if (surplus <= 0) {\n      change();\n      return;\n    }\n\n    self.timer = setTimeout(change, surplus);\n\n    return () => {\n      self.timer && clearTimeout(self.timer);\n    };\n  }, [toggle]);\n\n  function change() {\n    if (toggle !== innerState) setInnerState(toggle);\n  }\n\n  return isDisabled ? toggle : innerState;\n}\n"],"names":["useEffect","useState","useSelf","useDelayToggle","toggle","duration","change","innerState","setInnerState","isDisabled","self","timer","openTime","Date","now","surplus","setTimeout","clearTimeout"],"mappings":"AAAA;AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO,CAAC;AAC5C,SAASC,OAAO,QAAQ,QAAQ,CAAC;AAEjC,8DAA8D,GAC9D,OAAO,SAASC,cAAc,CAACC,MAAe,EAA2B;QAAzBC,QAAQ,GAARA,+CAAc,kBAAH,GAAG;QAiCnDC,MAAM,GAAf,SAASA,MAAM,GAAG;QAChB,IAAIF,MAAM,KAAKG,UAAU,EAAEC,aAAa,CAACJ,MAAM,CAAC,CAAC;IACnD,CAAC;IAlCD,IAAMK,UAAU,GAAG,CAACJ,QAAQ,AAAC;IAE7B,IAAoCJ,GAAgB,oBAAhBA,QAAQ,CAACG,MAAM,CAAC,IAAA,EAA7CG,UAAU,GAAmBN,GAAgB,GAAnC,EAAEO,aAAa,GAAIP,GAAgB,GAApB,AAAqB;IAErD,IAAMS,IAAI,GAAGR,OAAO,CAAC;QACnBS,KAAK,EAAE,IAAI;QACXC,QAAQ,EAAER,MAAM,GAAGS,IAAI,CAACC,GAAG,EAAE,GAAG,IAAI;KACrC,CAAC,AAAC;IAEHd,SAAS,CAAC,WAAM;QACd,IAAIS,UAAU,EAAE,OAAO;QAEvB,IAAIL,MAAM,EAAE;YACVE,MAAM,EAAE,CAAC;YACT,OAAO;QACT,CAAC;QAED,IAAIS,OAAO,GAAGL,IAAI,CAACE,QAAQ,GAAGC,IAAI,CAACC,GAAG,EAAE,GAAGJ,IAAI,CAACE,QAAQ,GAAG,CAAC,AAAC;QAC7DG,OAAO,GAAGV,QAAQ,GAAGU,OAAO,CAAC;QAE7B,IAAIA,OAAO,IAAI,CAAC,EAAE;YAChBT,MAAM,EAAE,CAAC;YACT,OAAO;QACT,CAAC;QAEDI,IAAI,CAACC,KAAK,GAAGK,UAAU,CAACV,MAAM,EAAES,OAAO,CAAC,CAAC;QAEzC,OAAO,WAAM;YACXL,IAAI,CAACC,KAAK,IAAIM,YAAY,CAACP,IAAI,CAACC,KAAK,CAAC,CAAC;QACzC,CAAC,CAAC;IACJ,CAAC,EAAE;QAACP,MAAM;KAAC,CAAC,CAAC;IAMb,OAAOK,UAAU,GAAGL,MAAM,GAAGG,UAAU,CAAC;AAC1C,CAAC"}