{"version":3,"sources":["/Users/lixianjie/project/openSource/m78/packages/m78/src/button/button.tsx"],"sourcesContent":["import React, { useMemo, useState } from \"react\";\nimport cls from \"clsx\";\n\nimport { Spin } from \"../spin\";\nimport { m78Config as config } from \"../config\";\n\nimport { FullSize } from \"../common\";\nimport { ButtonPropsWithHTMLButton, ButtonPropsWithHTMLLink } from \"./types\";\nimport { formatChildren } from \"./utils\";\nimport { useFn } from \"@m78/hooks\";\nimport { isPromiseLike } from \"@m78/utils\";\n\nfunction Button(btnProps: ButtonPropsWithHTMLButton): JSX.Element;\nfunction Button(btnProps: ButtonPropsWithHTMLLink): JSX.Element;\nfunction Button(btnProps: ButtonPropsWithHTMLLink | ButtonPropsWithHTMLButton) {\n  const {\n    size,\n    color,\n    circle,\n    outline,\n    block,\n    icon,\n    disabled,\n    loading: _loading,\n    children,\n    className,\n    text,\n    href,\n    innerRef,\n    ...props\n  } = btnProps as ButtonPropsWithHTMLLink & ButtonPropsWithHTMLButton;\n\n  const darkMode = config.useState((state) => state.darkMode);\n\n  // 由内部控制的加载状态\n  const [innerLoading, setInnerLoading] = useState(false);\n\n  const loading = _loading || innerLoading;\n\n  // 配置了color切是text/icon以外的按钮类型, 或是无color且darkMode下，直接使用亮色水波纹\n  const isLightEffect = (!!color && !text && !icon) || (!color && darkMode);\n\n  const classNames = cls(\n    \"m78 m78-init m78-btn\",\n    \"m78-effect\",\n    \"__md\",\n    {\n      [`__${color}`]: color,\n      [`__${size}`]: size,\n      __circle: circle,\n      __outline: outline,\n      __block: block,\n      __text: text,\n      __icon: icon,\n      __light: isLightEffect,\n      __disabled: disabled || loading,\n    },\n    className\n  );\n\n  const newChildren = useMemo(() => formatChildren(children), [children]);\n\n  const isLink = !!href;\n\n  const onClick = useFn(\n    (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n      // 如果用户点击事件返回了promise like, 自动设置loading状态\n      const res = btnProps.onClick?.(e);\n\n      if (isPromiseLike(res)) {\n        setInnerLoading(true);\n        res.finally(() => {\n          setInnerLoading(false);\n        });\n      }\n    }\n  );\n\n  return React.createElement(\n    isLink ? \"a\" : \"button\",\n    {\n      type: isLink ? undefined : \"button\", // 禁用默认的html button submit类型\n      href,\n      ...props,\n      className: classNames,\n      disabled: !!disabled || !!loading,\n      ref: innerRef,\n      onClick,\n    },\n    <Spin open={!!loading} size={FullSize.small} full />,\n    ...newChildren\n  );\n}\n\nexport { Button };\n"],"names":["React","useMemo","useState","cls","Spin","m78Config","config","FullSize","formatChildren","useFn","isPromiseLike","Button","btnProps","size","color","circle","outline","block","icon","disabled","loading","_loading","children","className","text","href","innerRef","props","darkMode","state","innerLoading","setInnerLoading","isLightEffect","classNames","__circle","__outline","__block","__text","__icon","__light","__disabled","newChildren","isLink","onClick","e","res","finally","createElement","type","undefined","ref","open","small","full"],"mappings":"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"}