{"version":3,"sources":["/Users/lixianjie/project/openSource/m78/packages/m78/src/transition/transition-base.tsx"],"sourcesContent":["import React, { useMemo } from \"react\";\nimport { useSpring, animated } from \"react-spring\";\nimport { useSelf, useMountState, useIsUnmountState } from \"@m78/hooks\";\nimport { TransitionBaseProps } from \"./types\";\n\nexport const _TransitionBase = (props: TransitionBaseProps) => {\n  const {\n    open = true,\n    appear = true,\n    tag = \"div\",\n    springProps,\n    innerRef,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    mountOnEnter,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    unmountOnExit,\n    to,\n    from,\n    interpolater,\n    changeVisible = true,\n    children,\n    ...passProps\n  } = props;\n\n  const self = useSelf({\n    isFirst: true,\n  });\n\n  const [mount, unmount] = useMountState(open, props);\n  const isUnmount = useIsUnmountState();\n\n  const Animated = useMemo(() => animated[tag as \"div\"], []);\n\n  const animate = useMemo(() => {\n    const f = self.isFirst;\n    self.isFirst = false;\n\n    const _t = { ...to, __progress: 1 };\n    const _f = { ...from, __progress: 0 };\n\n    // 初始显示且启用了appear\n    if (appear && open && f) {\n      return {\n        to: _t,\n        from: _f,\n      };\n    }\n\n    return {\n      to: open ? _t : _f,\n      from: undefined,\n    };\n  }, [open, to, from]);\n\n  const styles = useSpring({\n    ...springProps,\n    ...animate,\n    onRest(...args: any) {\n      if (springProps?.onRest) {\n        springProps.onRest(...args);\n      }\n      if (!open && !isUnmount()) unmount();\n    },\n  });\n\n  if (!mount) return null;\n\n  /* 存在插值器则先走插值器 */\n  const sp = interpolater ? interpolater(styles, open) : styles;\n\n  return (\n    <Animated\n      {...passProps}\n      ref={innerRef}\n      style={{\n        ...props.style,\n        ...sp,\n        visibility: changeVisible\n          ? sp.__progress.to((p: number) => (p <= 0 ? \"hidden\" : \"visible\"))\n          : undefined,\n        // 动画大部分未出场时阻止事件，防止隐藏出现等场景错误点击\n        pointerEvents: sp.__progress.to((p: number) =>\n          p <= 0.7 ? \"none\" : undefined\n        ),\n      }}\n      className={props.className}\n    >\n      {typeof children === \"function\" ? children(sp) : children}\n    </Animated>\n  );\n};\n\n_TransitionBase.displayName = \"TransitionBase\";\n"],"names":["React","useMemo","useSpring","animated","useSelf","useMountState","useIsUnmountState","_TransitionBase","props","open","appear","tag","springProps","innerRef","mountOnEnter","unmountOnExit","to","from","interpolater","changeVisible","children","passProps","self","isFirst","mount","unmount","isUnmount","Animated","animate","f","_t","__progress","_f","undefined","styles","onRest","args","sp","ref","style","visibility","p","pointerEvents","className","displayName"],"mappings":"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"}